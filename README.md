# ЗАДАНИЕ 1

# уровень  1

## Описание проекта
Mesto — это веб-приложение для загрузки и обмена фотографиями. Оно предоставляет пользователям возможность создавать и редактировать свои профили, загружать фотографии, удалять их, а также собирать и учитывать лайки под фото. Основные функции приложения включают:

- **Загрузка фотографий:**  Пользователи могут загружать свои фотографии, которые будут отображаться на главной странице.
- **Удаление фотографий:** Пользователи могут удалять загруженные фотографии.
- **Сбор и учёт лайков:** Пользователи могут ставить лайки на фотографии других пользователей, а также видеть количество лайков под каждой фотографией.
- **Создание и редактирование профиля:** Пользователи могут создавать свои профили и редактировать их информацию.

## Архитектура микрофронтендов
Для реализации проекта Mesto мы будем использовать подход микрофронтендов, который позволяет разделить приложение на более мелкие, независимые части, каждая из которых может разрабатываться и развёртываться отдельно.

## Выбор технологии
В качестве технологии для реализации микрофронтендов мы выбрали **Module Federation**. Этот подход позволяет динамически загружать модули из удалённых приложений, что идеально подходит для нашего случая, где разные команды могут работать над различными частями приложения.

## Структура проекта

### Основные микрофронтенды

- **Микрофронтенд галереи:**
    - **Компоненты:** Gallery, PhotoCard
    - **Блоки:** card, places
    - **Функции:** отображение галереи фотографий, удаление карточек, загрузка новых фотографий.
    - **API:** взаимодействие с сервером для получения списка фотографий, их загрузки и удаления.

- **Микрофронтенд профиля:**
    - **Компоненты:** Profile, EditProfilePopup, EditAvatarPopup
    - **Блоки:** profile
    - **Функции:** создание и редактирование профиля пользователя, отображение информации о пользователе.
    - **API:** взаимодействие с сервером для получения и обновления данных профиля.

- **Микрофронтенд лайков:**
    - **Компоненты:** LikeButton, LikeCounter
    - **Блоки:** card/__like-button, card/__like-count
    - **Функции:** учёт и отображение лайков, синхронизация состояния лайков с сервером.
    - **API:** взаимодействие с сервером для обновления состояния лайков.

- **Микрофронтенд аутентификации:**
    - **Компоненты:** Login, Register, InfoTooltip
    - **Блоки:** auth-form
    - **Функции:** регистрация и вход пользователя в систему.
    - **API:** взаимодействие с сервером для аутентификации пользователей.

## Схема архитектуры

├── Auth-MF (Авторизация)\
│   ├── /blocks/auth-form (Стили и структура форм)\
│   ├── /components (React-компоненты Login и Register)\
│   └── /utils/auth.js (Утилиты авторизации)\
│\
├── Profile-MF (Профиль)\
│   ├── /blocks/profile (Стили профиля)\
│   ├── /components (React-компоненты для профиля и попапа)\
│   └── /contexts (Контекст текущего пользователя)\
│\
├── Gallery-MF (Галерея)\
│   ├── /blocks/card и /blocks/places (Карточки фото и список галереи)\
│   ├── /components (Компоненты галереи)\
│   └── /utils/api.js (API для фото)\
│\
├── Likes-MF (Лайки)\
│   ├── /blocks/card/__like-button (Стили кнопок лайков)\
│   ├── /components (Кнопка и счетчик лайков)\
│   └── /services/state.js (Состояние лайков)\
│\
└── Shared-MF (Общие компоненты и стили)\
    ├── /components (Модальные окна, кнопки)\
    ├── /utils/helpers.js (Общие утилиты)\
    └── /styles/variables.css (Глобальные переменные CSS)\

## Схема взаимодействия микрофронтендов:

|\
├── Auth-MF (Авторизация) <---> Shared-MF\
|\
├── Profile-MF (Профиль) <---> Shared-MF\
|\
├── Gallery-MF (Галерея) <---> Likes-MF (Лайки) <---> Shared-MF \
|

**Объяснение:**

* **Gateway** отвечает за маршрутизацию и отображение основных компонентов. Он выступает в роли "дирижера", который координирует работу всех микрофронтендов.
* **Auth-MF**, **Profile-MF**, **Gallery-MF** и **Likes-MF** разрабатываются независимо. Каждый из них отвечает за свою часть функциональности и может быть обновлен или развернут независимо от других.
* **Shared-MF** содержит общие стили, компоненты и утилиты, которые используются всеми микрофронтендами. Это позволяет избежать дублирования кода и упрощает поддержку.

**Стрелки** показывают зависимости между микрофронтендами. Например, `Gallery-MF` использует компоненты и функции из `Likes-MF` и `Shared-MF`.

# Выбор технологии для микрофронтендов в проекте Mesto

Чтобы выбрать между **Module Federation** и **Single SPA** для разделения проекта Mesto на микрофронтенды, рассмотрим каждую технологию и их преимущества, а также применимость к функциональности проекта.

## Module Federation

### Преимущества:
- **Динамическая загрузка модулей:** Module Federation позволяет загружать модули (микрофронтенды) динамически, что может снизить время загрузки приложения за счет загрузки только необходимых компонентов.
- **Совместное использование зависимостей:** Микрофронтенды могут использовать общие зависимости, что уменьшает размер загружаемых файлов и снижает дублирование кода.
- **Простота интеграции:** Легче интегрировать существующие приложения и библиотеки, поскольку можно подключать микрофронтенды без значительной переработки архитектуры.
- **Поддержка различных фреймворков:** Module Federation поддерживает различные фреймворки и библиотеки, что позволяет использовать React, Vue, Angular и другие вместе.

### Недостатки:
- **Сложность конфигурации:** Требуется больше усилий для настройки и конфигурации Webpack для работы с Module Federation.
- **Проблемы с версионностью:** Если микрофронтенды используют разные версии библиотек, это может привести к конфликтам.

## Single SPA

### Преимущества:
- **Универсальность:** Single SPA позволяет использовать различные фреймворки и библиотеки в одном приложении, что делает его универсальным решением.
- **Управление жизненным циклом:** Позволяет управлять жизненным циклом микрофронтендов, что может быть полезно для сложных приложений с множеством взаимодействий.
- **Простота в использовании:** Более простая архитектура для новичков, легко понять, как организованы микрофронтенды.

### Недостатки:
- **Производительность:** Могут возникнуть проблемы с производительностью из-за необходимости загружать все зависимости для каждого микрофронтенда.
- **Меньшая гибкость в управлении зависимостями:** В отличие от Module Federation, сложнее делиться зависимостями между микрофронтендами.

## Сравнение на основе функциональности Mesto

### Загрузка фотографий:
- **Module Federation:** Легко реализовать динамическую загрузку компонентов, что подходит для загрузки изображений.
- **Single SPA:** Можно реализовать, но может быть менее эффективным.

### Удаление фотографий:
- **Module Federation:** Поддерживает динамическое обновление компонентов, что удобно для удаления фотографий.
- **Single SPA:** Также можно сделать, но с возможными проблемами в производительности.

### Сбор и учёт лайков под фото:
- **Module Federation:** Легче реализовать совместное использование состояния между компонентами.
- **Single SPA:** Подходит, но сложнее управлять состоянием.

### Создание профиля и его редактирование:
- **Module Federation:** Позволяет использовать общие компоненты для редактирования профиля, что удобно.
- **Single SPA:** Можно реализовать, но может потребоваться больше усилий для управления состоянием.

## Итоговое решение

На основе вышеизложенных аргументов, **Module Federation** более подходящий вариант для проекта Mesto. Она обеспечивает лучшую производительность, гибкость в управлении зависимостями и позволяет динамически загружать микрофронтенды, что важно для функций, связанных с загрузкой и удалением фотографий.


# уровень  2

## Структура кода


├── Gateway (Корневой проект)\
│   ├── index.js (Точка входа приложения)\
│   ├── routes.js (Маршрутизация между микрофронтендами)\
│   ├── App.js (Основной компонент приложения)\
│   ├── Header.js (Заголовок)\
│   ├── Footer.js (Подвал)\
│   └── webpack.config.js (Конфигурация Webpack для Module Federation)\
│\
├── Auth-MF (Авторизация)\
│   ├── /blocks/auth-form (Стили и структура форм)\
│   │   ├── auth-form.css\
│   │   ├── /__button/auth-form__button.css\
│   │   ├── /__input/auth-form__input.css\
│   │   └── /__link/auth-form__link.css\
│   ├── /components (React-компоненты Login и Register)\
│   │   ├── Login.js\
│   │   └── Register.js\
│   ├── /utils (Утилиты авторизации)\
│   │   └── auth.js\
│   └── webpack.config.js (Конфигурация Webpack для авторизации)\
│\
├── Profile-MF (Профиль)\
│   ├── /blocks/profile (Стили профиля)\
│   │   ├── profile.css\
│   │   ├── /__info/profile__info.css\
│   │   └── /__title/profile__title.css\
│   ├── /components (React-компоненты для профиля и попапа)\
│   │   ├── Profile.js\
│   │   ├── EditProfilePopup.js\
│   │   └── EditAvatarPopup.js\
│   ├── /contexts (Контекст текущего пользователя)\
│   │   └── CurrentUserContext.js\
│   └── webpack.config.js (Конфигурация Webpack для профиля)\
│\
├── Gallery-MF (Галерея)\
│   ├── /blocks/card (Стили карточек фотографий)\
│   │   ├── card.css\
│   │   ├── /__image/card__image.css\
│   │   └── /__description/card__description.css\
│   ├── /blocks/places (Стили галереи)\
│   │   ├── places.css\
│   │   ├── /__item/places__item.css\
│   │   └── /__list/places__list.css\
│   ├── /components (Компоненты галереи)\
│   │   ├── Gallery.js\
│   │   └── PhotoCard.js\
│   ├── /utils (API для работы с фотографиями)\
│   │   └── api.js\
│   └── webpack.config.js (Конфигурация Webpack для галереи)\
│\
├── Likes-MF (Лайки)\
│   ├── /blocks/card/__like-button (Стили кнопок лайков)\
│   │   ├── card__like-button.css\
│   │   └── card__like-button_is-active.css\
│   ├── /blocks/card/__like-count (Стили счетчика лайков)\
│   │   └── card__like-count.css\
│   ├── /components (Компоненты лайков)\
│   │   ├── LikeButton.js\
│   │   └── LikeCounter.js\
│   ├── /services (Управление состоянием лайков)\
│   │   └── state.js\
│   └── webpack.config.js (Конфигурация Webpack для лайков)\
│\
├── Shared-MF (Общие компоненты и стили)\
│   ├── /components (Универсальные компоненты)\
│   │   ├── Modal.js\
│   │   └── Button.js\
│   ├── /utils (Общие утилиты)\
│   │   └── helpers.js\
│   ├── /styles (Глобальные CSS-переменные)\
│   │   └── variables.css\
│   └── webpack.config.js (Конфигурация Webpack для shared)\
│\
├── Vendor (Внешние ресурсы)\
│   ├── fonts.css\
│   ├── normalize.css\
│   └── /fonts\
│       ├── Inter-Black.woff2\
│       └── Inter-Regular.woff2\


## Обоснование предложенной структуры кода

### Основные цели разделения:

* **Поддержка модульности:** Код структурирован так, чтобы каждая функциональная часть (авторизация, профиль, галерея, лайки) имеет свою собственную область ответственности и может разрабатываться независимо.
* **Простота в понимании и масштабировании:** Архитектура интуитивно понятна, а добавление новых микрофронтендов или компонентов не требует значительных изменений в существующем коде.
* **Повторное использование общих ресурсов:** Общие компоненты (модальные окна, кнопки, утилиты) и стили выделены в отдельный микрофронтенд (`Shared-MF`), что минимизирует дублирование и упрощает обновление.

### Ключевые аспекты структуры:

1. **Разделение на микрофронтенды:**

   Каждый микрофронтенд выполняет одну логическую функцию:

   * `Auth-MF` (Авторизация): управление входом и регистрацией пользователей.
   * `Profile-MF` (Профиль): отображение и редактирование профиля.
   * `Gallery-MF` (Галерея): работа с фотографиями.
   * `Likes-MF` (Лайки): управление состоянием лайков.
   * `Shared-MF` (Общие компоненты): повторно используемые элементы (например, кнопки, модальные окна).

   Такое разделение обеспечивает:

   * **Независимую разработку:** Команды могут работать параллельно над разными микрофронтендами.
   * **Быстрое развертывание:** Обновления каждого микрофронтенда можно внедрять независимо.

2. **Распределение файлов внутри микрофронтендов:**

   Файлы из исходной структуры проекта были перераспределены по функциональным областям:

   * `blocks`: перенесены в микрофронтенды, где они используются. Например, блок `auth-form` помещен в `Auth-MF`, а `card` разделен между `Gallery-MF` и `Likes-MF`.
   * `components`: React-компоненты из исходного файла теперь разложены по микрофронтендам, к которым они относятся. Например:
     * `Login.js` и `Register.js` — в `Auth-MF`.
     * `EditProfilePopup.js` — в `Profile-MF`.
   * Общие файлы (например, модальные окна и кнопки): перенесены в `Shared-MF` для переиспользования.

3. **Использование Module Federation:**

   Каждый микрофронтенд имеет свой `index.js` и конфигурацию Webpack. Это позволяет:

   * Подключать микрофронтенды динамически через Gateway.
   * Разделять общие библиотеки (React, React-DOM) для уменьшения размера бандлов.
   * Инкапсулировать микрофронтенды, сохраняя их независимость.

### Преимущества предложенной структуры:

1. **Упрощенная разработка:**

   * Локализация файлов в рамках одного микрофронтенда уменьшает связность между частями системы.
   * Команды разработчиков могут сосредотачиваться на своих частях без необходимости понимать всю систему.

2. **Улучшенная масштабируемость:**

   * Добавление новых микрофронтендов не требует изменений в существующих микрофронтендах.
   * Module Federation позволяет легко подключать новые функциональные модули.

3. **Оптимизация повторного использования:**

   * Выделение общих компонентов и стилей в `Shared-MF` упрощает поддержку, так как изменения в общих элементах автоматически применяются везде.

4. **Производительность:**

   * Динамическая загрузка микрофронтендов уменьшает объем стартового бандла, обеспечивая более быструю загрузку приложения.

5. **Простота поддержки:**

   * Ясное распределение файлов упрощает навигацию по проекту. Например, вся логика, связанная с лайками, находится в `Likes-MF`, а профиля — в `Profile-MF`.



** **
** **


# ЗАДАНИЕ 2

### Схема архитектуры 
[Файл на Google Диске](https://drive.google.com/file/d/1bkU2Z-gQNex7CHJ8Dx1g3glRktvLWUOc/view?usp=sharing)
* вкладка AS IS - описывает архитектуру монолита
* вкладка TO BE - описывает архитектуру микросервисного приложения


# Декомпозиция решения для электронной площадки Товарной биржи

## Описание бизнес-процессов

**Описание:**  
Электронная площадка товарной биржи выступает посредником между покупателями и продавцами, предоставляя им инструменты для проведения торговых операций онлайн.

**Функционал:**

### Управление пользователями:
- **Регистрация пользователя:** Позволяет новым пользователям создавать учетные записи на платформе, предоставляя необходимую информацию (имя, адрес электронной почты, пароль).
- **Аутентификация:** Обеспечивает доступ к учетной записи пользователя на основе предоставленных учетных данных (логин и пароль).
- **Присвоение ролей (покупатель, продавец):** Определяет тип доступа и функциональность, доступную пользователю на платформе.
- **Нотификация нового пользователя:** Отправляет уведомление (например, по электронной почте) новому пользователю после успешной регистрации.
- **Валидация токена безопасности:** Проверяет действительность токена безопасности, используемого для авторизации запросов к API.

### Управление профилем:
- **Добавить товар в профиль пользователя:** Позволяет продавцам добавлять информацию о товарах, которые они хотят продать.
- **Добавить услугу в профиль пользователя:** Позволяет продавцам добавлять информацию об услугах, которые они предлагают.
- **Изменить товар пользователя:** Позволяет продавцам редактировать информацию о товарах, доступных в их профиле.
- **Изменить услугу пользователя:** Позволяет продавцам редактировать информацию об услугах, доступных в их профиле.
- **Удалить услугу пользователя:** Позволяет продавцам удалять услуги, которые больше не доступны.
- **Удалить товар пользователя:** Позволяет продавцам удалять товары, которые больше не доступны.

### Управление заказами:
- **Создание заказа:** Позволяет покупателям формировать заказы на выбранные товары/услуги.
- **Редактирование заказа:** Позволяет покупателям вносить изменения в заказы до их подтверждения продавцом.
- **Сохранение заказа:** Позволяет покупателям сохранять созданные заказы для дальнейшего редактирования или оформления.
- **Подтверждение заказа:** Позволяет продавцам подтверждать или отклонять полученные заказы.
- **Размещение заказа:** Переводит заказ в статус "размещен", после чего продавец начинает его обработку.
- **Отобразить все заказы:** Отображает список всех заказов, сделанных покупателем или полученных продавцом.
- **Отобразить детали заказа:** Отображает подробную информацию о конкретном заказе.
- **Нотификация об изменении состояния заказа:** Отправляет уведомления покупателю и продавцу об изменениях в статусе заказа (например, подтвержден, отправлен, доставлен).

### Управление аукционами:
- **Создать аукцион:** Позволяет продавцам создавать аукционы для продажи товаров/услуг по наивысшей ставке.
- **Редактировать аукцион:** Позволяет продавцам вносить изменения в параметры аукциона до его завершения.
- **Обработать новую заявку на аукцион:** Обрабатывает новые ставки, сделанные на аукционе, и обновляет информацию о текущей цене.

### Платежи:
- **Определить способ оплаты:** Позволяет покупателям выбирать предпочтительный способ оплаты заказа.

## Основные бизнес-процессы:

### Регистрация и авторизация:
1. Новый пользователь регистрируется на платформе, указывая свою роль (покупатель/продавец).
2. Система проверяет данные и создает учетную запись.
3. Пользователь может авторизоваться, используя свои учетные данные.

### Управление профилем:
1. Продавцы создают и редактируют свои профили, добавляя информацию о товарах и услугах.
2. Покупатели могут просматривать профили продавцов и искать интересующие их товары/услуги.

### Создание и обработка заказов:
1. Покупатель выбирает товар/услугу и формирует заказ.
2. Продавец получает уведомление о новом заказе и может подтвердить или отклонить его.
3. После подтверждения заказа покупатель выбирает способ оплаты.
4. Система обрабатывает платеж и уведомляет обе стороны о статусе заказа.

### Проведение аукционов:
1. Продавцы создают аукционы, устанавливая начальную цену и сроки проведения.
2. Покупатели делают ставки на товары/услуги, выставленные на аукцион.
3. Система определяет победителя аукциона по истечении срока его действия.

### Обработка платежей:
1. Система интегрируется с платежными системами для обеспечения безопасной оплаты товаров/услуг.
2. Покупатели могут выбирать удобный для них способ оплаты.

### Уведомления:
1. Система отправляет уведомления пользователям о важных событиях, таких как новые заказы, изменения статуса заказа, окончание аукционов и т.д.

## Декомпозиция монолита на микросервисы

### 1. Сервис авторизации и аутентификации
**Функции:**
- Регистрация пользователя
- Присвоение ролей
- Нотификация нового пользователя
- Аутентификация
- Валидация токена безопасности

### 2. Сервис профайла пользователей
**Функции:**
- Добавить товар в профиль пользователя
- Добавить услугу в профиль пользователя
- Изменить товар пользователя
- Изменить услугу пользователя
- Удалить услугу пользователя
- Удалить товар пользователя  
**Описание:** Обеспечивает управление учётными записями пользователей, авторизацию, аутентификацию и операции с профилем.

### 3. Сервис управления заказами
**Функции:**
- Создание заказа
- Редактирование заказа
- Сохранение заказа
- Подтверждение заказа
- Размещение заказа
- Отобразить все заказы
- Отобразить детали заказа
- Нотификация об изменении состояния заказа  
**Описание:** Управляет жизненным циклом заказов, от их создания до подтверждения и завершения, включая уведомления.

### 4. Сервис платежей
**Функции:**
- Определить способ оплаты
- Управление взаимодействием с внешними платёжными системами:
  - Инициация платежа
  - Запрос статуса платежа
  - Подтверждение платежа
  - Обработка отмен платежей  
**Описание:** Отвечает за интеграцию с платёжными сервисами, управление статусами транзакций и выбор способов оплаты.

### 5. Сервис каталога товаров
**Функции:**
- Управление каталогом размещённых товаров и услуг.
- Предоставление информации о доступности товаров для оформления заказов.  
**Описание:** Обеспечивает доступ к информации о товарах и услугах, их наличии и основных характеристиках.

### 6. Сервис аукционов
**Функции:**
- Создать аукцион
- Редактировать аукцион
- Обработать новую заявку на аукцион  
**Описание:** Управляет процессом создания, редактирования и проведения аукционов, а также обработкой заявок участников.

### 7. Сервис отчетности
**Функции:**
- Генерация аналитических отчетов на основе данных о заказах, платежах и пользовательской активности  
**Описание:** Предоставляет сводную информацию для мониторинга и аналитики деятельности платформы.

### 8. Сервис технической поддержки
**Функции:**
- Обработка обращений пользователей  
**Описание:** Отвечает за взаимодействие с пользователями по вопросам технической поддержки.

### 9. Сервис управления апелляциями
**Функции:**
- Обработка апелляций пользователей, связанных с заказами, аукционами и платежами  
**Описание:** Обеспечивает разрешение конфликтов между пользователями.

### 10. Оркестратор Саги
**Функции:**
- Управление процессами оформления заказов с использованием паттерна Сага.
- Интеграция с сервисами для выполнения последовательности действий.
- Обработка сценариев успешного и неуспешного завершения транзакций  
**Описание:** Координирует взаимодействие между сервисами в процессе оформления заказов, создание заказа, инициацию и подтверждение платежа, а также уведомление пользователей.

### 11. Сервис управления площадками
**Функции:**
- Создание и настройка новых площадок
- Обновление конфигураций площадок (категории, правила и лимиты)
- Управление статусами площадок (активна, неактивна)
- Мониторинг и отчетность о деятельности площадок
- Интеграция с сервисом управления аукционами для проверки доступности площадок  
**Описание:** Сервис управления площадками отвечает за администрирование и конфигурацию различных торговых площадок на платформе. Он обеспечивает управление параметрами и статусами площадок, что позволяет гибко настраивать среду для проведения торгов и аукционов.

## Схема взаимодействия
![Описание изображения](https://drive.google.com/uc?export=view&id=1hgjl4xidmuOBUawvWan-zcWDIaMlWmf_)

**Компоненты и их задачи:**

### API Gateway:
- Центральная точка входа для всех клиентских запросов.
- Управляет маршрутизацией и безопасностью запросов к микросервисам.

### Оркестратор Саги:
- Управляет сложными бизнес-процессами, такими как оформление заказа.
- Обеспечивает целостность транзакций с возможностью отката.

### Сервисы:

- **Сервис профайла пользователей:** Управляет данными пользователей и их профилями.
- **Каталог товаров:** Обеспечивает хранение и управление данными о товарах.
- **Сервис управления заказами:** Обрабатывает создание и управление заказами.
- **Сервис авторизации и аутентификации:** Обеспечивает безопасность и управление доступом пользователей.
- **Сервис отчетности:** Генерирует отчеты и аналитику по различным аспектам торговой деятельности.
- **Сервис технической поддержки:** Обеспечивает поддержку пользователей и обработку их запросов.
- **Сервис управления апелляциями:** Управляет процессом подачи и рассмотрения апелляций пользователей.
- **Сервис управления платежами:** Интегрируется с внешними платежными системами для обработки транзакций.
- **Сервис управления площадками:** Управляет конфигурацией и статусами различных торговых площадок.
- **Сервис управления аукционами:** Управляет процессом создания и проведения аукционов.

## Взаимодействие между компонентами:

- **API Gateway** маршрутизирует запросы от клиента к соответствующим микросервисам.
- **Оркестратор Саги** координирует действия между сервисами управления аукционами, заказами и платежами для обеспечения надежного выполнения транзакций.
- **Сервис управления аукционами** взаимодействует с **Каталогом товаров** и **Сервисом управления площадками** для проверки доступности и конфигурирования аукционов.
- **Сервис отчетности** получает данные от других сервисов для формирования аналитики и отчетов.
- **Сервис платежей** взаимодействует с внешними платежными системами для обработки и подтверждения транзакций.


